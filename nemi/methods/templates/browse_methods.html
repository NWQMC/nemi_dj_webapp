{% extends "base.html" %}

{% block title %}NEMI Browse Methods{% endblock %}

{% block page_script %}
	<script type="text/javascript">
		$(document).ready(function(){
			// Set up the show/hide button for method categories 
			$(".method-category-div").each(function(){
				var subcatDiv = $(this).find(".method-subcategory-div");
				$(this).find('.category-button').click(function(){
					var catImgEl = $(this).find('img');
					if (catImgEl.attr('alt') == 'show') {
						catImgEl.attr('src', "{{ STATIC_URL }}/images/triangle-down-image36.gif");
						catImgEl.attr('alt', 'hide');
						catImgEl.attr('title', 'Hide subcategories');
						subcatDiv.show();
					}
					else{
						catImgEl.attr('src', "{{ STATIC_URL }}/images/triangle-right-image36.gif");
						catImgEl.attr('alt', 'show');
						catImgEl.attr('title', 'Show subcategories');
						subcatDiv.hide();
					}
				});
			});
			// Set up the show/hide/ button for method subcategories 
			$(".method-subcategory-div").each(function(){
				var tableEl = $(this).find(".data-table");
				$(this).find('.subcategory-button').click(function(){
					var imgEl = $(this).find('img');
					if (imgEl.attr('alt') == 'show') {
						imgEl.attr('src', "{{ STATIC_URL }}/images/triangle-down-image36.gif");
						imgEl.attr('alt', 'hide');
						imgEl.attr('title', 'Hide methods');
						tableEl.show();
					}
					else{
						imgEl.attr('src', "{{ STATIC_URL }}/images/triangle-right-image36.gif");
						imgEl.attr('alt', 'show');
						imgEl.attr('title', 'Show methods');
						tableEl.hide();
					}
				});
			});
			// Set show/hide button for method details 
			$(".show-hide-detail-div").each(function(){
				var detailsDiv = $(this).find(".hidden-details-div");
				$(this).find('button').click(function(){
					var detailsImgEl = $(this).find('img');
					if (detailsImgEl.attr('alt') == 'show') {
						detailsImgEl.attr('src', "{{ STATIC_URL }}/images/triangle-down-image36.gif");
						detailsImgEl.attr('alt', 'hide');
						detailsImgEl.attr('title', 'Hide details');
						detailsDiv.show();
					}
					else{
						detailsImgEl.attr('src', "{{ STATIC_URL }}/images/triangle-right-image36.gif");
						detailsImgEl.attr('alt', 'show');
						detailsImgEl.attr('title', 'Show details');
						detailsDiv.hide();
					}						
				});
			});
		});
	</script>
{% endblock %}

{% block page-content %}
	{% load data_format %}
	<p style="font-size: large;"><h2>NEMI contains {{ object_list|length }} methods.</h2></p>
	{% regroup object_list by method_category as objects_by_category %}
	{% for by_category in objects_by_category %}
		<div class="method-category-div">
			<h3><button class="show-hide-toggle category-button" title="Show subcategories" type="button"><img src="{{ STATIC_URL }}images/triangle-right-image36.gif" alt="show" /></button>&nbsp;{{ by_category.grouper|lower|capfirst }} - {{ by_category.list|length}} methods</h3>
			{% regroup by_category.list by method_subcategory as objects_by_subcategory %}
			{% for by_subcategory in objects_by_subcategory %}
				<div class="method-subcategory-div" style="display: none;">
					<h4><button class="show-hide-toggle subcategory-button" title="Show methods" type="button"><img src="{{ STATIC_URL }}images/triangle-right-image36.gif" alt="show" /></button>&nbsp;{{ by_subcategory.grouper }} - {{ by_subcategory.list|length }} methods</h4>				
					<table class="data-table" style="display:none;">
						<tr><th></th><th>Method Number</th><th>Method Descriptive Name</th><th>Method Source</th></tr>
						{% for object in by_subcategory.list %}
							<tr>
								<td class="view-button"><a title="View method details" href="{% url methods-method_summary object.method_id %}">View</a></td>
								<td>{{ object.source_method_identifier|safe }}</td>
								<td>{{ object.method_descriptive_name }}</td>
								<td>{% include "method_source_details.html" with r=object %}
								<!-- every where else we just show the method_source so I commented this out.
	<!--								<a title="Click to show/hide details" 
									href="javascript:show_hide('#{{ object.method_id }}-method-source-detail')">
									{% if "EPA" in object.method_source %}
										EPA
									{% else %}
									   {% if "USGS" in object.method_source %}
											USGS
										{% else %}
											{{ object.method_source }}
										{% endif %}
									{% endif %}
									</a>
									<div id="{{ object.method_id }}-method-source-detail" style="display: none;">
										<table class="inside-table">
											<tr><th>Contact Information:</th><td>{{ object.method_source_contact|safe }}</td></tr>
											<tr>
												<th>URL:</th>
												<td><span class="external-link">{{ object.method_source_url|clickable_links }}</span></td>
											</tr>
										</table>
									</div>
									-->
								</td>
							</tr>
						{% endfor %}
					</table>
				</div>
			{% endfor %}
		</div>
	{% endfor %}
{% endblock %}