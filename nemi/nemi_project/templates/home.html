{% extends "base.html" %}

{% block page_style %}
	<link rel="stylesheet" href="{{ STATIC_URL }}styles/jquery-ui-1.10.0.custom/smoothness/jquery-ui-1.10.0.custom.css" media="screen" type="text/css" />
	<link rel="stylesheet" href="{{ STATIC_URL }}lib/select2-master/select2.css" media="screen" type="text/css" />
{% endblock %}

{% block page_script %}
	<script src="{{ STATIC_URL }}lib/select2-master/select2.js"></script>
	<script src="{{ STATIC_URL }}script/jquery-ui/jquery-ui-1.10.0.custom.js"></script>
	<script src="{{ STATIC_URL }}script/Utils.js"></script>
	<script src="{{ STATIC_URL }}script/AnalyteDialog.js"></script>
	 
	<script type="text/javascript">
		function updateBrowseMethodCount() {
			$.ajax({
				url: '{% url "methods-method_count" %}',
				success : function(resp) {
					$('#browse-count-span').html('NEMI current contains ' + resp.method_count + ' methods, protocols and procedures.');	
				}
			});
		}
		
		function getCheckboxListHtml(choices /* array [Objects] */, fieldName /* String */, choiceIdBase /* String */) {
			/*
			Return a string representing a list of checkboxes. The values and display values are defined in choices
			which is an array of Object with the properties, value and display_value. All checkboxes will have the same
			name attribute, fieldName. Each checkbox's id will be choiceIdBase-i with i being the index.
			*/
			var checkboxes = '';
			for (var i = 0; i < choices.length; i++) {
				choiceId = choiceIdBase + i;
				checkboxes +='<li><input type="checkbox" name="' + fieldName + '" id="' + choiceId + 
					'" value="' + choices[i].value + '"/><label for="' + choiceId + '">' + choices[i].display_value + '</label></li>';
			}
			return checkboxes;
		}
		
		function setInitialCheckedState(checkboxes /* jquery elements */, setToDefault /* Boolean */) {
			/*
			Set the checked property of the checkboxes. All disabled checkboxes are set to false.
			Enabled checkboxes are set to true if setToDefault is true and the sessionStorage is updated
			by forcing a change event. Otherwise, sessionStorage is checked
			for each checkbox and it's property is set accordingly, with the default being true.
			*/
			checkboxes.filter(':disabled').prop('checked', false).change();
			if (setToDefault) {
				checkboxes.filter(':enabled').prop('checked', true).change();
			}
			else {
				checkboxes.filter(':enabled').each(function() {
					var elId = $(this).attr('id');
					if (sessionStorage[elId] == 'off') {
						$(this).prop('checked', false);
					}
					else {
						$(this).prop('checked', true);
					}
				});
			}
		}
		
		function setMethodTypeState(checkboxes /* jquery elements */, setToDefault /* Boolean */) {
			/*
			Retrieve the category from the visible divs hidden input. Retreive the valid method types
			for that category and disable checkboxes that are not valid for that category.
			Then set the state of the checkboxes.
			*/
			if (checkboxes.length > 0) {
				var category = $('#filter-action .input-section-div:visible input:hidden[name="category"]').val();

				if (category == '') {
					Utils.setEnabled(checkboxes, true);
					setInitialCheckedState(checkboxes, setToDefault);
					
				}
				else {
					// Retrieve valid method types for this category and set sensitivity
					$.ajax({
						url: '{% url "methods-method_types" %}',
						data : {'category' : category},
						success: function(resp) {
							checkboxes.each(function() {
								Utils.setEnabled($(this), isCheckboxInChoices($(this), resp.choices));
							});
							setInitialCheckedState(checkboxes, setToDefault);
						}
					});
				}
			}
		}
		
		function createCheckboxes(
				url, /*String */ 
				data, /* Object */
				setState, /* optional function which sets the state of the checkboxes */
				listEl, /*jquery element */
				fieldName, /* String */ 
				choiceIdBase /* String */) {
			/* 
			Make an ajax call to retrieve the values to be used to create the checkboxes within the list element listEl.
			The checkboxes will be created with a name attribute set to fieldName and their id attribute
			set to choiceIdBase-i. After the checkboxes are created and a change handler added to save state, setState if
			specified is called to set the state of the checkboxes.
			 */
			$.ajax({
				url: url,
				data: data,
				success: function(resp) {
					listEl.html(getCheckboxListHtml(resp.choices, fieldName, choiceIdBase))
					
					var checkboxes = listEl.find('input[type="checkbox"]');

					// Add change handler to save the state of the checkbox
					checkboxes.change(function() {
						// Make sure at least one checkbox is checked
						var checkedEls = checkboxes.filter(':checked');
						if (checkboxes.filter(':enabled').filter(':checked').length > 0) {
							var elId = $(this).attr('id')
							if ($(this).is(':checked')) {
								sessionStorage[elId] = 'on';
							}
							else {
								sessionStorage[elId] = 'off';
							}
						}
						else {
							//Don't allow change operation if element is enabled
							$(this).filter(':enabled').prop('checked', true);
						}
					});
					
					if (setState) {
						setState(checkboxes, false);
					}
				}
			});			
		}
		
		function isCheckboxInChoices(checkboxEl /* jquery element */, choices /* array[Object]*/) {
			/*
			Return true if checkboxEl's value is in choices. This function assumes that
			each object in choices as a "value" property.
			*/
			var thisValue = checkboxEl.attr('value');
			for (var i = 0; i < choices.length; i++){
				if (thisValue == choices[i].value) {
					return true;
				}
			}
			return false;
		}
		
		function showSearchSubcategory(buttonEl /* jquery element */, setToDefault /* Boolean */) {
			/*
			Make buttonEl the currently active element and make the corresponding divs visible.
			All others should be hidden. If setToDefault is true, set all input values on the visible div to their 
			default state.
			Note: that this does not include setting the state of the Limit By section of the filtered
			search.
			*/
			
			// Update buttonEl and the currently active sibling button's visual state. 
			buttonEl.removeClass('not-active').addClass('highlight');
			buttonEl.siblings('.highlight').removeClass('highlight').addClass('not-active');
			
			// Show the associated div and hide the currently visible sibling div (if any)
			var divToShow = buttonEl.data('actionDivId');
			divToShow.show(0, buttonEl.data('showCallback'))
			divToShow.siblings(':visible').hide();
			
			// Show the associated header div (if any) and hide the currently visibling sibling div.
			var headerToShow = buttonEl.data('headerId');
			if (headerToShow) {
				headerToShow.show();
				headerToShow.siblings(':visible').hide();
			}
			
			// Set default state if requested. 
			if (setToDefault) {
				divToShow.find('input[type="text"]').val('').change();
				divToShow.find('textarea').val('').change();
				divToShow.find('select').val('all').change();				
			}
			setInitialCheckedState(divToShow.find('input[type="checkbox"]'), setToDefault)
		}
		
		function validateAnalyteField(textEl /* text field */, fieldKind /* String */) {
			/* Validate the analyte field and return the validated string */
			var result = $.trim(textEl.val());
			var valuesList = result.split('\n');
			if (activeCategory() === 'regulatory') {
				if (valuesList.length > 1) {
					alert('You can only enter one analyte ' + fieldKind + '.');
					result = valuesList[0];
				}
			}
			else {
				if (valuesList.length > 3) {
					alert('You can only enter three analyte ' + fieldKind + 's.');
					result = valuesList.slice(0,3).join('\n');
				}
			}
			return result;
		}
		
		function activeCategory() {
			return $('#filter-action>div:visible').find('input[name="category"]').val();
		}
		
		function isMediaNameEnabled() {
			return $.inArray(activeCategory(), ['', 'chemical']) !== -1;
		}
		function isSourceEnabled(category) {
			return $.inArray(activeCategory(), ['', 'chemical', 'statistical']) !== -1;
		}
		function isInstrumentationEnabled(category) {
			return $.inArray(activeCategory(), ['', 'chemical']) !== -1;
		}
		
		function setActionDivState(buttonEl) {
			/* Set the category and subcategory inputs in buttonEl's associated actionDiv */
			var category = buttonEl.data('category');
			var subcategory = buttonEl.data('subcategory');
			var actionDiv = buttonEl.data('actionDivId');
			
			actionDiv.find('input:hidden[name="category"]').val(category);
			actionDiv.find('input:hidden[name="subcategory"]').val(subcategory);						
		}
		function setLimitBySelectSensitivity() {
			/*
			Set the sensitivity of the select elements in the limit by filtered search section for the section
			represented by buttonEl.
			*/
			$('.limit-by-select-field').filter('input[type="hidden"]').each(function() {
				var enableFn = $(this).data('enableFn');
				if (enableFn) {
					Utils.setSelect2Enabled($(this), enableFn());
				}
			});
		}
		
		function setFilteredSearchButtonState() {
			var searchBtn = $('#filtered-action-div .search-button');
			var activeDiv = $('#filter-action>div:visible');
			var category = activeDiv.find('input[name="category"]').val();
			if (((activeDiv.attr('id') == 'analyte-search-div') && (category == '')) || (category == 'regulatory')){
				// Set state to disabled if the analyte code or name fields are both empty.
				var nameVal = $.trim($('#analyte-name-field').val());
				var codeVal = $.trim($('#analyte-code-field').val());
				Utils.setEnabled (searchBtn, (nameVal != '' || codeVal != ''));
			}
			else {
				Utils.setEnabled(searchBtn, true);
			}
		}
	
		$(document).ready(function() {
			// Add data to select2 elements
			$('#media-name-field').data('enableFn', isMediaNameEnabled);
			$('#source-field').data('enableFn', isSourceEnabled);
			$('#instrumentation-field').data('enableFn', isInstrumentationEnabled);
			
			// Dynamically create option menus
			Utils.createSelectMenu('media-name-field','{% url "methods-media_name" %}');
			Utils.createSelectMenu('source-field', '{% url "methods-source" %}');
			Utils.createSelectMenu('instrumentation-field', '{% url "methods-instrumentation" %}');
			Utils.createSelectMenu('gear-type-field', '{% url "methods-gear_types" %}');
			Utils.createSelectMenu('study_objective',  '{% url "methods-stat_objectives" %}');
			Utils.createSelectMenu('item_type', '{% url "methods-stat_item_types" %}');
			Utils.createSelectMenu('analysis_type', '{% url "methods-stat_analysis_types" %}');
			Utils.createSelectMenu('publication_source_type', '{% url "methods-stat_publication_source" %}');
			Utils.createSelectMenu('media_emphasized', '{% url "methods-stat_media_emphasized" %}');
			Utils.createSelectMenu('special_topic', '{% url "methods-stat_special_topics" %}');
			
			// Dynamically create checkboxes 
			createCheckboxes('{% url "methods-method_types" %}', {}, setMethodTypeState, $('#method-type-selections'), 'method_type', 'method_type-');
			createCheckboxes('{% url "methods-subcategories" %}', {'category' : 'Chemical'}, setInitialCheckedState, $('#chemical-subcategory-selections'), 'subcategory', 'chemical-subcategory-');
			createCheckboxes('{% url "methods-subcategories" %}', {'category' : 'Toxicity assay'}, setInitialCheckedState, $('#toxicity-subcategory-selections'), 'subcategory', 'toxicity-subcategory-');
			createCheckboxes('{% url "methods-subcategories" %}', {'category' : 'Statistical'}, setInitialCheckedState, $('#statistical-subcategory-selections'), 'subcategory', 'statistical-subcategory-');

			// Make select2 out of static option menus.
			$('select.static-field').select2({
				width: 'copy',
				minimumResultsForSearch: 15,
				placeholder: 'All',
				allowClear: true,
				containerCss: {
					'font-size' : 'small',
				}
			});
			
			// Add change handler to save state of inputs with class static-field 
			$('.static-field').change(function() {
				sessionStorage[$(this).attr('id')] = $(this).val();
			});
			
			// Add click handler for the section show/hide buttons.
			$(".section-div").each(function() {
				var contentDiv = $(this).find('.subcategory-div');
				$(this).find('h2 button').click(function() {
					var buttonImgEl = $(this).find('img');
					if (buttonImgEl.attr('alt') == 'show') {
						$(this).attr('title', 'Hide section');
						buttonImgEl.attr('alt', 'hide');
						buttonImgEl.attr('src', '{{ STATIC_URL }}images/triangle-down-image36.gif');
						contentDiv.show();					
					}
					else {
						$(this).attr('title', 'Show section');
						buttonImgEl.attr('alt', 'show');
						buttonImgEl.attr('src', '{{ STATIC_URL }}images/triangle-right-image36.gif');
						contentDiv.hide();
					}
				});
			});
			
			// Add click handler for the subsection show/hide buttons 
			$('.subcategory-action-div').each(function() {
				var contentDiv = $(this).find('.subsection-div');
				$(this).find('h3 button').click(function() {
					var buttonImgEl = $(this).find('img');
					if (buttonImgEl.attr('alt') == 'show') {
						$(this).attr('title', 'Hide subsection');
						buttonImgEl.attr('alt', 'hide');
						buttonImgEl.attr('src', '{{ STATIC_URL }}images/triangle-down-image36.gif');
						contentDiv.show();
					}
					else {
						$(this).attr('title', 'Show subsection');
						buttonImgEl.attr('alt', 'show');
						buttonImgEl.attr('src', '{{ STATIC_URL }}images/triangle-right-image36.gif');
						contentDiv.hide();
					}
				});
			});
			
			// Associate the id of the div to show/hide for each subcategory button and set show callback if necessary 
			$('#keyword-search-button').data('actionDivId', $('#keyword-search-div'));
			$('#number-search-button').data('actionDivId', $('#number-search-div'));
			$('#browse-search-button').data('actionDivId', $('#browse-methods-div'));
			$('#browse-search-button').data('showCallback', updateBrowseMethodCount);
			
			// In addition to actionDivId and showCallback (as needed), the filtered search buttons should set headerId to the
			// correct header, set the form's action url (actionUrl), and set category and subcategory to the button's category/subcategory.
			$('#analytes-search-button').data('actionDivId', $('#analyte-search-div'));
			$('#analytes-search-button').data('headerId', $('#analytes-header'));
			$('#analytes-search-button').data('actionUrl', '{% url "methods-analyte_results" %}');
			$('#analytes-search-button').data('category', '');
			
			$('#chemical-search-button').data('actionDivId', $('#chemical-search-div'));
			$('#chemical-search-button').data('headerId', $('#chemical-header'));
			$('#chemical-search-button').data('actionUrl', '{% url "methods-results" %}');
			$('#chemical-search-button').data('category', 'chemical');
			
			$('#microbiological-search-button').data('actionDivId', $('#analyte-search-div'));
			$('#microbiological-search-button').data('headerId', $('#microbiological-header'));
			$('#microbiological-search-button').data('actionUrl', '{% url "methods-analyte_results" %}');
			$('#microbiological-search-button').data('category', 'biological');
			$('#microbiological-search-button').data('subcategory', 'Microbiological');
			
			$('#community-search-button').data('actionDivId', $('#community-search-div'));
			$('#community-search-button').data('headerId', $('#community-header'));
			$('#community-search-button').data('actionUrl', '{% url "methods-analyte_results" %}');
			$('#community-search-button').data('category', 'biological');
			$('#community-search-button').data('subcategory', 'Population/Community');
			
			$('#toxicity-search-button').data('actionDivId', $('#toxicity-search-div'));
			$('#toxicity-search-button').data('headerId', $('#toxicity-header'));
			$('#toxicity-search-button').data('actionUrl', '{% url "methods-results" %}');
			$('#toxicity-search-button').data('category', 'toxicity assay');
			
			$('#physical-search-button').data('actionDivId', $('#analyte-search-div'));
			$('#physical-search-button').data('headerId', $('#physical-header'));
			$('#physical-search-button').data('actionUrl', '{% url "methods-analyte_results" %}');
			$('#physical-search-button').data('category', 'physical');
			
			$('#statistical-search-button').data('actionDivId', $('#statistical-search-div'));
			$('#statistical-search-button').data('headerId', $('#statistical-header'));
			$('#statistical-search-button').data('actionUrl', '{% url "methods-statistical_results" %}');
			$('#statistical-search-button').data('category', 'statistical');
			
			$('#regulatory-search-button').data('actionDivId', $('#analyte-search-div'));
			$('#regulatory-search-button').data('headerId', $('#regulatory-header'));
			$('#regulatory-search-button').data('actionUrl', '{% url "methods-regulatory_results" %}');
			$('#regulatory-search-button').data('category', 'regulatory');
			
						
			// Add click handlers for subcategory buttons 
			$('.subcategory-button').click(function() {
				// Save currently active subcategory button's id for the subcategory div.
				sessionStorage[$(this).parents('.subcategory-selection-div').attr('id')] = $(this).attr('id');
				
				showSearchSubcategory($(this), true);
				
				// Set div's elements to default and update session storage by forcing change event.
				var divToShow = $(this).data('actionDivId');
				divToShow.find('input[type="text"]').val('').change();
				divToShow.find('textarea').val('').change();
				setInitialCheckedState(divToShow.find('input[type="checkbox"]', true));
				
				// If this is a filtered search subcategory then we also need to update the Limit by section.
				if ($(this).parents('#filtered-selection-div')) {
					setActionDivState($(this));
					setLimitBySelectSensitivity();
					
					// Attach the appropriate action to the limit by form
					$('#filtered-search-limits form').attr('action', $(this).data('actionUrl'));
									
					// Default selects to 'all' selection.
					$('.limit-by-select-field').select2('val', 'all', true);
					$('.filter-select').select2('val', 'all', true);
					
					// Set method type checkbox state. Default all enabled inputs to true.
					setMethodTypeState($('#method-type-selections input'), true);
					
					// Set sensitivity of the search button
					setFilteredSearchButtonState();
				}
			});
			
			// Add a click handler for the search button in the filter search section.
			$('#filtered-search-div .search-button').click(function() {
				var limitByForm = $('#filtered-search-limits form');
				var actionDiv = $('#filter-action>div:visible');
				
				//Remove any hidden inputs from the last search 
				limitByForm.find('input:hidden').not('.limit-by-select-field').remove();
				
				//Add hidden inputs to limitByForm from the currently visible subcategory form. 
				var hiddenInputHtml = '';
			
				actionDiv.find(':input').filter('[name]').filter(':enabled').each(function() {
					if ($(this).is('[type="checkbox"]') && !($(this).is(':checked'))) {
						return;
					}
					hiddenInputHtml += '<input type="hidden" name="' + $(this).attr('name') + '" value="' + $(this).val() + '" />';					
				});
				
				limitByForm.append(hiddenInputHtml);
				
				limitByForm.submit();
				
				return false;
			});
			
			// Initialize Find analyte dialog and set up click handler for find analyte buttons. 
			AnalyteDialog.initialize($('#find-analyte-dialog'), '{% url "methods-analyte_select" %}');
			$('#find-analyte-name-button').click(function() {
				return AnalyteDialog.show(
						'name', 
						$('#analyte-name-field'), 
						$('#analyte-search-div input[name="category"]').val(),
						$('#analyte-search-div input[name="subcategory"]').val()
				);
			});
			$('#find-analyte-code-button').click(function() {
				return AnalyteDialog.show('code', $('#analyte-code-field'), $());
			});	
			
			// Add change event handlers to analyte name and code field. The event handler limits to text 
			// fields to three analytes (or  one if regulatory) and it sets the sensitivity of the analyte text and buttons as
			// appropriate.
			var nameEl = $('#analyte-name-field');
			var nameFindBtn = $('#find-analyte-name-button');
			var codeEl = $('#analyte-code-field');
			var codeFindBtn = $('#find-analyte-code-button');
			
			nameEl.change(function() {
				var value = validateAnalyteField($(this), 'name');
				$(this).val(value);
				Utils.setEnabled(codeEl, (value == ''));
				Utils.setEnabled(codeFindBtn, (value == ''));
				setFilteredSearchButtonState();
			});
			
			codeEl.change(function() {
				var value = validateAnalyteField($(this), 'code');
				$(this).val(value);
				Utils.setEnabled(nameEl, (value == ''));
				Utils.setEnabled(nameFindBtn, (value == ''));
				setFilteredSearchButtonState();
			});
			
			//Check to make sure that at least one method type is checked.
			$('#method-type-selections input[type="checkbox"]').click(function(){
				if ($(this).is('not(:checked)') && $(this).siblings.is(':not(checked)')) {
					$(this).prop('checked', true);
				}
			});
			
			// Preprocess the Browse submit to set sessionStorage to clear any visible divs on browse results page.
			$('#browse-methods-div form').submit(function() {
				sessionStorage.clearBrowsePage = 'true';
				return true;
			});
			
			// Initialize data from sessionStorage
			if (sessionStorage['general-selection-div']) {
				showSearchSubcategory($('#' + sessionStorage['general-selection-div']), false);
			}
			if (sessionStorage['filtered-selection-div']) {
				var buttonEl = $('#' + sessionStorage['filtered-selection-div']);
				showSearchSubcategory(buttonEl, false);
				setActionDivState(buttonEl);
				// Attach the appropriate action to the limit by form
				$('#filtered-search-limits form').attr('action', buttonEl.data('actionUrl'));
				setLimitBySelectSensitivity();
			}
			$('.static-field').each(function() {
				$(this).val(sessionStorage[$(this).attr('id')]).change();
			});
			
			// Set sensitivity of Limit by Search button 
			setFilteredSearchButtonState();
		}); 
	</script>
{% endblock %}

{% block page_info %}
<p>NEMI is a searchable database of environmental methods, protocols, and procedures 
that allows scientists and managers to find and compare data-collection methods
and protocols for all stages of the monitoring process.
</p>
{% endblock %}

{% block page-content %}
	<div id="general-search-div" class="section-div">
		<h2>
			<button class="show-hide-toggle" title="Hide section" type=button>
				<img src="{{ STATIC_URL }}images/triangle-down-image36.gif" alt="hide" /> 
			</button>
			GENERAL SEARCH
		</h2>
		<div id="general-subcategory-div>" class="subcategory-div">
			<div id="general-selection-div" class="subcategory-selection-div">
				<ul>
					<li class="highlight subcategory-button" id="keyword-search-button">KEYWORD</li>
					<li class="not-active subcategory-button" id="number-search-button">NUMBER</li>
					<li class="not-active subcategory-button" id="browse-search-button">BROWSE</li>
				</ul>
			</div>
			<div id="general-action-div" class="subcategory-action-div">
		    	<div id="keyword-search-div" class="input-section-div">
                   	<form action="{% url 'methods-keyword' %}" method="get">
                   		<table class="general-search-form-table">
                   			<tr>
                   				<th><label for="keyword-search-field">Search entire NEMI database by keyword:</label></th>
                       			<td><input type="text" id="keyword-search-field" name="keyword_search_field" class="static-field"/></td>
							</tr>
						</table>
						<div class="button-div">
							<input class="search-button" type="submit" value="Search"/>
						</div>
                	</form>
            	</div>
            	<div id="number-search-div" class="input-section-div" style="display:none;">
                   	<form action="{%url 'methods-results' %}" method=get>  
                   		<table class="general-search-form-table">
							<tr>
								<th><label for="number-search-field">Search for a method number:</label></th>
                       			<td><input id="number-search-field" type="text" name="method_number" class="static-field"/></td>
							</tr>
						</table> 
						<div class="button-div">
							<input class="search-button" type="submit" value="Search"/>
						</div>
               		</form>
            	</div>		
            	<div id="browse-methods-div" class="input-section-div" style="display: none;">
            		<form action="{% url 'methods-browse' %}" method="get">
            			<table class="general-search-form-table">
            				<tr>
		            			<td><b><span>Browse the entire database:</span></b>
		            			<span id="browse-count-span"></span></td>
		            		</tr>
	            		</table>
	            		<div class="button-div">
	            			<input class="search-button" type="submit" value="Browse"/>
	            		</div>
	            	</form>
            	</div>				
			</div>
		</div>
 		<div class="section-spacer-div"></div>	
	</div>
	<div id="filtered-search-div" class="section-div">
		<h2>
			<button class="show-hide-toggle" title="Hide section" type=button>
				<img src="{{ STATIC_URL }}images/triangle-down-image36.gif" alt="hide" /> 
			</button>
			FILTERED SEARCH		
		</h2>
		<div id="filtered-subcategory-div>" class="subcategory-div">
			<div id="filtered-selection-div" class="subcategory-selection-div">
				<ul>
					<li class="highlight subcategory-button" id="analytes-search-button">ANALYTES</li>
					<li class="not-active subcategory-button" id="chemical-search-button">CHEMICAL</li>
					<li class="not-active subcategory-button" id="microbiological-search-button">MICROBIOLOGICAL</li>
					<li class="not-active subcategory-button" id="community-search-button">COMMUNITY</li>
					<li class="not-active subcategory-button" id="toxicity-search-button">TOXICITY</li>
					<li class="not-active subcategory-button" id="physical-search-button">PHYSICAL</li>
					<li class="not-active subcategory-button" id="statistical-search-button">STATISTICAL</li>
					<li class="not-active subcategory-button" id="regulatory-search-button">REGULATORY</li>
				</ul>
			</div>
			<div id="filtered-action-div" class="subcategory-action-div">
				<div id="filter-specific-div">
					<div id="filter-header">
						<div id="analytes-header">
							<p>Search by ANALYTES</p>
							<hr/>
						</div>
						<div id="chemical-header" style="display: none;">
							<p>Limit search to CHEMICAL methods</p>
							<hr/>
						</div>
						<div id="microbiological-header" style="display: none;">
							<p>Limit search to MICROBIOLOGICAL methods</p>
							<hr />
						</div>
						<div id="community-header" style="display: none;">
							<p>Limit search to POPULATION/COMMUNITY methods</p>
							<hr/>
						</div>
						<div id="toxicity-header" style="display: none;">
							<p>Limit search to TOXICITY methods</p>
							<hr />
						</div>
						<div id="physical-header" style="display: none;">
							<p>Limit search to PHYSICAL methods</p>
							<hr />
						</div>
						<div id="statistical-header" style="display: none;">
							<p>Limit search to STATISTICAL methods</p>
							<hr />
						</div>
						<div id="regulatory-header" style="display: none;">
							<p>Limit search to REGULATORY methods</p>
							<hr />
						</div>
					</div>
					<div id="filter-action">
						<div id="analyte-search-div" class="input-section-div">
							<form>
								<div style="display: inline-block;">
									<table class="general-search-form-table">
										<tr>
											<th><label for="analyte-name-field">Analyte name(s):</label></th>
											<td><textarea id="analyte-name-field" name="analyte_name"  class="static-field" cols=50 rows=3></textarea></td>
											<td><input type="button" id="find-analyte-name-button" class="find-button" value="Find Analyte Names"></td>
										</tr>
										<tr>
											<td colspan="3"><span style="font-size: large; font-weight: bold; font-style: italic;">OR</span></td>
										<tr>
											<th><label for="analyte-code-field">Analyte code(s):</label></th>
											<td><textarea id="analyte-code-field" name="analyte_code" cols=50 rows=3 class="static-field"></textarea></td>
											<td><input type="button" id="find-analyte-code-button" class="find-button" value="Find Analyte Codes"></td>
										</tr>
									</table>
									<input type="hidden" name="category" value=""/>
									<input type="hidden" name="subcategory" value="" />
								</div>
							</form>
							<div id="find-analyte-dialog" style="display: none;">
								<div id="find-analyte-text-entry-div">
									<p>Enter a few characters of the 
										<span style="font-weight" id="analyte-id-kind">analyte name:</span>
									</p>
									<form>
										<input type="text" id="find-analyte-text" size=30 />
										<button id="find-analyte-button" class="find-button">Find</button>
									</form>
								</div>
								<div id="analyte-match-div">
									<div id="analyte-search-list-div" style="float: left; display:inline-block">
										<p>Matching analytes:</p>
										<select style="width:20em;" multiple="multiple" id="analyte-search-list" size=15>
										</select>
										<span id="no-analyte-values" style="display:none;">No matches</span>
									</div>
									<div id="find-analyte-button-div" style="display:inline-block; margin-top: 4em; padding-left: 10px;">
										<button id="add-to-select" class="find-button" style="width: 100%;">Add&nbsp;&gt;&gt;</button>
										<br />
										<button id="remove-from-select" class="find-button" style="width: 100%;">&lt;&lt;&nbsp;Remove</button>
									</div>
									<div id="find-analyte-match-div" style="float: right; display:inline-block;">
										<p><span style="font-weight: bold">Select for search</span>(up to three):</p>
										<select style="width:20em;" multiple="multiple" id="analyte-select-list" size=3>
										</select>
									</div>
								</div>
							</div>
						</div>
						<div id="chemical-search-div" class="input-section-div" style="display: none;">
							<form>
								<div style="display: inline-block;">
									<div class="no-style-list">
										<span class="header">Chemical subcategories:</span><br />
										<ul id="chemical-subcategory-selections" >
										</ul>
									</div>
									<input type="hidden" name="category" value="Chemical"/>
								</div>
							</form>					
						</div>
						<div id="community-search-div" class="input-section-div" style="display: none;">
							<form>
								<div style="display: inline-block;">
									<table class="general-search-form-table">
										<tr>
											<th><label for="analyte-type-field">Analyte type:</label></th>
											<td>
												<select id="analyte-type-field" name="analyte_type" class="static-field" style="width: 15em;">
 													<option></option>
 													<option value="Algae">Algae</option>
													<option value="Fish">Fish</option>
													<option value="Macroinvertebrate">Macroinvertebrate</option>
												</select>
											</td>
										</tr>
										<tr>
										<th><label for="waterbody-type-field">Waterbody type:</label></th>
											<td>
												<select id="waterbody-type-field" name="waterbody_type" class="static-field" style="width: 15em;">
													<option ></option>
													<option value="Estuary">Estuary</option>
													<option value="Lake">Lake</option>
													<option value="Ocean">Ocean</option>
													<option value="River">River</option>
													<option value="Non-wadeable stream">Non-wadeable stream</option>
													<option value="Wadeable stream">Wadeable stream</option>
													<option value="Wetland">Wetland</option>
												</select>
											</td>
										</tr>
										<tr>
										<th><label for="gear-type-field">Gear type:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="gear-type-field" name="gear_type" />
											</td>
										</tr>
									</table>
									<input type="hidden" name="category" value="Biological"/>
									<input type="hidden" name="subcategory" value="population/community" />
								</div>
							</form>
						</div>
						<div id="toxicity-search-div" class="input-section-div" style="display: none;">
							<form>
								<div style="display: inline-block;">
									<div class="no-style-list">
										<span class="header">Toxicity subcategories</span><br />
										<ul id="toxicity-subcategory-selections"></ul>
									</div>
									<table class="general-search-form-table">
										<tr>
											<th><label for="matrix-field">Matrix:</label></th>
											<td>
												<select id="matrix-field" name="matrix" class="static-field" style="width: 10em;">
													<option></option>
													<option value="Freshwater">Freshwater</option>
													<option value="Saltwater">Saltwater</option>
													<option value="Both">Both</option>
												</select>
											</td>
										</tr>
									</table>
									<input type="hidden" name="category" value="Toxicity Assay"/>
								</div>
							</form>
						</div>
						<div id="statistical-search-div" class="input-section-div" style="display: none;">
							<form>
								<div style="display: inline-block;">
									<div class="no-style-list">
										<span class="header">Statistical subcategories:</span><br />
										<ul id="statistical-subcategory-selections"></ul> 
									</div>
									<table class="general-search-form-table">
										<tr>
											<th><label for="study_objective">What are you interested in:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="study_objective" name="study_objective" />
											</td>
										</tr>
										<tr>
											<th><label for="item_type">Item type:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="item_type" name="item_type" />
											</td>
										</tr>
										<tr>
											<th><label for="complexity">Complexity:</label></th>
											<td>
												<select id="complexity" name="complexity" class="static-field" style="width: 8em;">
													<option ></option>
													<option value="Low">Low</option>
													<option value="Medium">Medium</option>
													<option value="High">High</option>
												</select>
											</td>
										</tr>
										<tr>
											<th><label for="analysis_type">Analysis type:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="analysis_type" name="analysis_type" />
											</td>
										</tr>
										<tr>
											<th><label for="publication_source_type">Publication source type:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="publication_source_type" name="publication_source_type">
											</td>
										</tr>
										<tr>
											<th><label for="media_emphasized">Media emphasized:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="media_emphasized" name="media_emphasized" />
											</td>
										</tr>
										<tr>
											<th><label for="special_topic">Special topic:</label></th>
											<td>
												<input type="hidden" class="filter-select" id="special_topic" name="special_topic" />
											</td>
										</tr>
									</table>
									<input type="hidden" name="category" value="Statistical"/>
								</div>
							</form>
						</div>
					</div>
				</div>
				<div id="limit-by-section">
					<h3>
						<button class="show-hide-toggle" title="Hide subsection" type=button>
							<img src="{{ STATIC_URL }}images/triangle-down-image36.gif" alt="hide" /> 
						</button>
						Limit by: (optional)		
					</h3>
					<br />
					<div id=filtered-search-limits class="input-section-div subsection-div">
						<form action="{% url 'methods-analyte_results' %}" method="get">
							<table class="general-search-form-table">
								<tr>
									<th><label id="media-name-field-label" for="media-name-field">Media name:</label></th>
									<td>
										<input type="hidden" class="limit-by-select-field" id="media-name-field" name="media_name"/>
									</td>
								</tr>
								<tr>
									<th><label id="source-field-label" for="source-field">Source:</label></th>
									<td>
										<input type="hidden" class="limit-by-select-field" id="source-field" name="source" />
									</td>
								</tr>
								<tr>
									<th><label id="instrumentation-field-label" for="instrumentation-field">Instrumentation:</label></th>
									<td>
										<input type="hidden" class="limit-by-select-field" id="instrumentation-field" name="instrumentation" />
									</td>
								</tr>
							</table>
							<div class="no-style-list">
								<span class="header">Method type:</span><br />
								<ul id="method-type-selections" >
								</ul>
							</div>
						</form>
					</div>
				</div>
				<div class="button-div">
					<input class="search-button" type="button" value="Search"/>
				</div>
			</div>
		</div>
		<div class="section-spacer-div"></div>	
	</div>
	
{% endblock %}

